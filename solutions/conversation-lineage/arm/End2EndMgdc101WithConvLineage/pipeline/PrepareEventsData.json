{
    "name": "PrepareEventsData",
    "properties": {
        "activities": [
            {
                "name": "Delete Old Calendar Event Blob Data",
                "type": "Delete",
                "dependsOn": [],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "dataset": {
                        "referenceName": "M365EventsBlob",
                        "type": "DatasetReference"
                    },
                    "logStorageSettings": {
                        "linkedServiceName": {
                            "referenceName": "blobstorage_via_sp_linkedservice",
                            "type": "LinkedServiceReference"
                        },
                        "path": {
                            "value": "@concat('logs/', pipeline().RunId, '/cleanup-logs/', pipeline().Pipeline)",
                            "type": "Expression"
                        }
                    },
                    "enableLogging": true,
                    "storeSettings": {
                        "type": "AzureBlobStorageReadSettings",
                        "recursive": true,
                        "enablePartitionDiscovery": false
                    }
                }
            },
            {
                "name": "M365 Calendar Events To AZBS",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Delete Old Calendar Event Blob Data",
                        "dependencyConditions": [
                            "Completed"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "Office365Source",
                        "dateFilterColumn": "CreatedDateTime",
                        "startTime": {
                            "value": "@pipeline().parameters.batchStartTime",
                            "type": "Expression"
                        },
                        "endTime": {
                            "value": "@pipeline().parameters.batchEndTime",
                            "type": "Expression"
                        },
                        "userScopeFilterUri": "",
                        "outputColumns": [
                            {
                                "name": "id"
                            },
                            {
                                "name": "allowNewTimeProposals"
                            },
                            {
                                "name": "createdDateTime"
                            },
                            {
                                "name": "lastModifiedDateTime"
                            },
                            {
                                "name": "changeKey"
                            },
                            {
                                "name": "categories"
                            },
                            {
                                "name": "originalStartTimeZone"
                            },
                            {
                                "name": "originalEndTimeZone"
                            },
                            {
                                "name": "responseStatus"
                            },
                            {
                                "name": "iCalUId"
                            },
                            {
                                "name": "reminderMinutesBeforeStart"
                            },
                            {
                                "name": "isOnlineMeeting"
                            },
                            {
                                "name": "isReminderOn"
                            },
                            {
                                "name": "hasAttachments"
                            },
                            {
                                "name": "subject"
                            },
                            {
                                "name": "body"
                            },
                            {
                                "name": "importance"
                            },
                            {
                                "name": "sensitivity"
                            },
                            {
                                "name": "start"
                            },
                            {
                                "name": "end"
                            },
                            {
                                "name": "location"
                            },
                            {
                                "name": "isAllDay"
                            },
                            {
                                "name": "isCancelled"
                            },
                            {
                                "name": "isOrganizer"
                            },
                            {
                                "name": "onlineMeeting"
                            },
                            {
                                "name": "onlineMeetingProvider"
                            },
                            {
                                "name": "recurrence"
                            },
                            {
                                "name": "responseRequested"
                            },
                            {
                                "name": "showAs"
                            },
                            {
                                "name": "transactionId"
                            },
                            {
                                "name": "type"
                            },
                            {
                                "name": "attendees"
                            },
                            {
                                "name": "organizer"
                            },
                            {
                                "name": "webLink"
                            },
                            {
                                "name": "attachments"
                            },
                            {
                                "name": "bodyPreview"
                            },
                            {
                                "name": "locations"
                            },
                            {
                                "name": "onlineMeetingUrl"
                            },
                            {
                                "name": "originalStart"
                            },
                            {
                                "name": "seriesMasterId"
                            }
                        ]
                    },
                    "sink": {
                        "type": "BinarySink",
                        "storeSettings": {
                            "type": "AzureBlobStorageWriteSettings"
                        }
                    },
                    "enableStaging": false
                },
                "inputs": [
                    {
                        "referenceName": "M365CalendarEvents",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "M365EventsBlob",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Delete Old Events Parquet Data",
                "type": "Delete",
                "dependsOn": [
                    {
                        "activity": "M365 Calendar Events To AZBS",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "dataset": {
                        "referenceName": "M365EventsParquet",
                        "type": "DatasetReference"
                    },
                    "logStorageSettings": {
                        "linkedServiceName": {
                            "referenceName": "blobstorage_via_sp_linkedservice",
                            "type": "LinkedServiceReference"
                        },
                        "path": {
                            "value": "@concat('logs/', pipeline().RunId, '/cleanup-logs/', pipeline().Pipeline)",
                            "type": "Expression"
                        }
                    },
                    "enableLogging": true,
                    "storeSettings": {
                        "type": "AzureBlobStorageReadSettings",
                        "recursive": true,
                        "enablePartitionDiscovery": false
                    }
                }
            },
            {
                "name": "Copy Calendar Events To Table",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Flatten Calendar Events By Attendees",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "ParquetSource",
                        "storeSettings": {
                            "type": "AzureBlobStorageReadSettings",
                            "recursive": true,
                            "wildcardFolderPath": "m365_events_parquet",
                            "wildcardFileName": "*.parquet",
                            "enablePartitionDiscovery": false
                        }
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "preCopyScript": "TRUNCATE TABLE flattened_events",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "StartDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "EndDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeStatusResponse",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "AttendeeStatusResponse",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeName",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "AttendeeName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeAddress",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "AttendeeAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "M365EventsParquet",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "FlattenedEventsTable",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Augment Flattened Calendar Events",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Copy Calendar Events To Table",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "AzureSqlSource",
                        "sqlReaderQuery": {
                            "value": "@{concat('with Internal_email_domains (EmailDomain) \nAS\n(\n    SELECT DISTINCT SUBSTRING(u.mail, CHARINDEX(''@'', u.mail), LEN(u.mail)) FROM users u WHERE u.mail IS NOT NULL\n)\nSELECT DISTINCT \nfev.[Id],\nfev.[CreatedDateTime],\nfev.[LastModifiedDateTime],\nfev.[iCalUId],\nfev.[Subject],\nfev.[Importance],\nfev.[Sensitivity],\nfev.[IsAllDay],\nfev.[IsCancelled],\nfev.[IsOrganizer],\nfev.[ResponseRequested],\nfev.[ContentType],\n[dbo].[udf_StripHTML](fev.[Content]) As Content,\nfev.[StartDateTime],\nfev.[StartTimeZone],\nfev.[EndDateTime],\nfev.[EndTimeZone],\nfev.[LocationDisplayName],\nfev.[AttendeeStatusResponse],\nCAST(CASE WHEN fev.[AttendeeStatusResponse] = ''Microsoft.OutlookServices.ResponseType''''None'''''' or fev.[AttendeeStatusResponse] = ''Microsoft.OutlookServices.ResponseType''''NotResponded''''''  THEN 0 ELSE 1 END AS BIT) as IsRead, \nfev.[AttendeeName],\nfev.[AttendeeAddress],\nfev.[Organizer],\nfev.[OrganizerName],\nfev.[ODataType],\nfev.[puser],\nfev.[ptenant],\nfev.[datarow],\nfev.[userrow],\nfev.[pagerow],\nu.aboutMe as OrganizerAboutMe,  \nu.birthday as OrganizerBirthday,   \nu.hireDate as OrganizerHireDate,  \nu.mySite as OrganizerMySite,  \nu.preferredName as OrganizerPreferredName,  \nu.accountEnabled as OrganizerAccountEnabled,  \nu.city as OrganizerCity,  \nu.companyName as OrganizerCompanyName,   \nu.country as OrganizerCountry,  \nu.createdDateTime as OrganizerCreatedDateTime,  \nISNULL(u.department, ''N/A'') as OrganizerDepartment,  \nu.displayName as OrganizerDisplayName,  \nu.givenName as OrganizerGivenName,  \nu.id as OrganizerId,  \nu.jobTitle as OrganizerJobTitle,  \nu.mail as OrganizerMail,  \nu.officeLocation as OrganizerOfficeLocation,  \nu.onPremisesImmutableId as OrganizerOnPremisesImmutableId,  \nu.postalCode as OrganizerPostalCode,  \nu.preferredLanguage as OrganizerPreferredLanguage,  \nu.state as OrganizerState,  \nu.streetAddress as OrganizerStreetAddress,  \nu.surname as OrganizerSurname,  \nu.usageLocation as OrganizerUsageLocation,  \nu.userPrincipalName as OrganizerUserPrincipalName,  \nu.userType as OrganizerUserType,  \nu.puser as OrganizerPuser ,  \nu.ptenant as OrganizerPtenant,  \nu.pAdditionalInfo as OrganizerPAdditionalInfo,  \nu.datarow as OrganizerDatarow,  \nu.userrow as OrganizerUserrow,  \nu.pagerow as OrganizerPagerow,\nISNULL(u.reportsTo, ''-'') as OrganizerReportsTo,\nu.managerEmail as OrganizerManagerEmail,\nuser_recipient_with_manager.managerEmail as AttendeeManagerEmail,\nISNULL(user_recipient_with_manager.reportsTo, ''-'') as AttendeeReportsTo\n, CAST(CASE WHEN SUBSTRING(fev.[AttendeeAddress], CHARINDEX(''@'', fev.[AttendeeAddress]), LEN(fev.[AttendeeAddress]))   NOT IN (SELECT EmailDomain FROM Internal_email_domains) THEN 1 ELSE 0 END AS BIT) as IsExternalEvent\n, CAST(CASE WHEN fev.AttendeeAddress = u.managerEmail THEN 1 ELSE 0 END AS BIT) as EventWithManager \n, CAST(CASE WHEN user_recipient_with_manager.managerEmail = fev.[Organizer] THEN 1 ELSE 0 END AS BIT) as EventWithSubordinate \n, '  , '''' , pipeline().parameters.batchEndTime, '''' ,' as Version\nFROM flattened_events fev  JOIN users u \non fev.[Organizer] = u.mail AND u.mail is not null\nLEFT JOIN users user_recipient_with_manager ON fev.AttendeeAddress = user_recipient_with_manager.mail;', '')}",
                            "type": "Expression"
                        },
                        "queryTimeout": "02:00:00",
                        "partitionOption": "None"
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "StartDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "EndDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeStatusResponse",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeStatusResponse",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "OrganizerHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "OrganizerAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "OrganizerCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsExternalEvent",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsExternalEvent",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "EventWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "EventWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "EventWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "EventWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Version",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Version",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "DedicatedSqlPoolDB",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "AugmentedFlattenedEventsTable",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Aggregate Augmented Calendar Events",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Augment Flattened Calendar Events",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "AzureSqlSource",
                        "sqlReaderQuery": {
                            "value": "@{concat('select\nfev.[CreatedDateTime],\nfev.[LastModifiedDateTime],\nfev.[iCalUId],\nfev.[Subject],\nfev.[Importance],\nfev.[Sensitivity],\nfev.[IsAllDay],\nfev.[IsCancelled],\nfev.[IsOrganizer],\nfev.[ResponseRequested],\nfev.[ContentType],\n[dbo].[udf_StripHTML](fev.[Content]) As Content,\nfev.[StartDateTime],\nfev.[StartTimeZone],\nfev.[EndDateTime],\nfev.[EndTimeZone],\nfev.[LocationDisplayName],\nfev.[Organizer],\nfev.[OrganizerName],\nfev.[ODataType],\nfev.[puser],\nfev.[ptenant],\nfev.[datarow],\nfev.[userrow],\nfev.[pagerow],\nfev.[OrganizerAboutMe],\nfev.[OrganizerBirthday],\nfev.[OrganizerHireDate],\nfev.[OrganizerMySite],\nfev.[OrganizerPreferredName],\nfev.[OrganizerAccountEnabled],\nfev.[OrganizerCity],\nfev.[OrganizerCompanyName],\nfev.[OrganizerCountry],\nfev.[OrganizerCreatedDateTime],\nISNULL(fev.[OrganizerDepartment], ''N/A'') as OrganizerDepartment,\nfev.[OrganizerDisplayName],\nfev.[OrganizerGivenName],\nfev.[OrganizerId],\nfev.[OrganizerJobTitle],\nfev.[OrganizerMail],\nfev.[OrganizerOfficeLocation],\nfev.[OrganizerOnPremisesImmutableId],\nfev.[OrganizerPostalCode],\nfev.[OrganizerPreferredLanguage],\nfev.[OrganizerState],\nfev.[OrganizerStreetAddress],\nfev.[OrganizerSurname],\nfev.[OrganizerUsageLocation],\nfev.[OrganizerUserPrincipalName],\nfev.[OrganizerUserType],\nfev.[OrganizerPuser],\nfev.[OrganizerPtenant],\nfev.[OrganizerPAdditionalInfo],\nfev.[OrganizerDatarow],\nfev.[OrganizerUserrow],\nfev.[OrganizerPagerow],\nfev.[IsExternalEvent],\nfev.[EventWithManager],\nfev.[EventWithSubordinate],\nISNULL(fev.[OrganizerReportsTo], ''-'') as OrganizerReportsTo,\nfev.[OrganizerManagerEmail],\nagg_events.Id,\nagg_events.AttendeeNames,\nagg_events.AttendeeAddresses,\nCAST(CASE agg_events.IsExternalEvent WHEN 1 THEN 1 ELSE 0 END AS BIT) As IsExternalEvent,\nCAST(CASE agg_events.EventWithManager WHEN 1 THEN 1 ELSE 0 END AS BIT) As EventWithManager,\nCAST(CASE agg_events.EventWithSubordinate WHEN 1 THEN 1 ELSE 0 END AS BIT) As EventWithSubordinate,\nCAST(CASE agg_events.IsRead WHEN 1 THEN 1 ELSE 0 END AS BIT) As IsRead\n  from (select\n    Id,\n      string_agg(cast([AttendeeName] as [varchar](max)),'', '') As AttendeeNames,\nstring_agg(cast([AttendeeAddress] as [varchar](max)),'', '') As AttendeeAddresses,\nMAX(CONVERT(tinyint,IsExternalEvent)) IsExternalEvent,\nMAX(CONVERT(tinyint,EventWithManager)) EventWithManager,\nMAX(CONVERT(tinyint,EventWithSubordinate)) EventWithSubordinate,\nMAX(CONVERT(tinyint,IsRead)) IsRead\n  FROM augmented_flattened_events\n  where Version = ', '''',  pipeline().parameters.batchEndTime, '''' , '\n  group by [Id]) as agg_events\n  CROSS APPLY\n  (SELECT TOP (1)\n[Id],\n[CreatedDateTime],\n[LastModifiedDateTime],\n[iCalUId],\n[Subject],\n[Importance],\n[Sensitivity],\n[IsAllDay],\n[IsCancelled],\n[IsOrganizer],\n[ResponseRequested],\n[ContentType],\n[Content],\n[StartDateTime],\n[StartTimeZone],\n[EndDateTime],\n[EndTimeZone],\n[LocationDisplayName],\n[AttendeeStatusResponse],\n[AttendeeName],\n[AttendeeAddress],\n[Organizer],\n[OrganizerName],\n[ODataType],\n[puser],\n[ptenant],\n[datarow],\n[userrow],\n[pagerow],\n[OrganizerAboutMe],\n[OrganizerBirthday],\n[OrganizerHireDate],\n[OrganizerMySite],\n[OrganizerPreferredName],\n[OrganizerAccountEnabled],\n[OrganizerCity],\n[OrganizerCompanyName],\n[OrganizerCountry],\n[OrganizerCreatedDateTime],\n[OrganizerDepartment],\n[OrganizerDisplayName],\n[OrganizerGivenName],\n[OrganizerId],\n[OrganizerJobTitle],\n[OrganizerMail],\n[OrganizerOfficeLocation],\n[OrganizerOnPremisesImmutableId],\n[OrganizerPostalCode],\n[OrganizerPreferredLanguage],\n[OrganizerState],\n[OrganizerStreetAddress],\n[OrganizerSurname],\n[OrganizerUsageLocation],\n[OrganizerUserPrincipalName],\n[OrganizerUserType],\n[OrganizerPuser],\n[OrganizerPtenant],\n[OrganizerPAdditionalInfo],\n[OrganizerDatarow],\n[OrganizerUserrow],\n[OrganizerPagerow],\n[IsExternalEvent],\n[EventWithManager],\n[EventWithSubordinate],\n[OrganizerReportsTo],\n[OrganizerManagerEmail]\nFROM [dbo].[augmented_flattened_events] where Id = agg_events.Id) fev;')}",
                            "type": "Expression"
                        },
                        "queryTimeout": "02:00:00",
                        "partitionOption": "None"
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "iCalUId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sensitivity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsAllDay",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsCancelled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "StartDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "StartTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "EndDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "EndTimeZone",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "LocationDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Organizer",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "OrganizerHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "OrganizerAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "OrganizerCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "OrganizerPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsExternalEvent",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsExternalEvent",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "EventWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "EventWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "EventWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "EventWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "OrganizerManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "OrganizerManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeNames",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeNames",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "AttendeeAddresses",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "AttendeeAddresses",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "DedicatedSqlPoolDB",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "AugmentedEventsTable",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Flatten Calendar Events By Attendees",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Delete Old Events Parquet Data",
                        "dependencyConditions": [
                            "Completed"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "JsonSource",
                        "storeSettings": {
                            "type": "AzureBlobStorageReadSettings",
                            "recursive": true,
                            "wildcardFolderPath": "m365_events_json",
                            "wildcardFileName": "*",
                            "enablePartitionDiscovery": false
                        },
                        "formatSettings": {
                            "type": "JsonReadSettings"
                        }
                    },
                    "sink": {
                        "type": "ParquetSink",
                        "storeSettings": {
                            "type": "AzureBlobStorageWriteSettings"
                        },
                        "formatSettings": {
                            "type": "ParquetWriteSettings"
                        }
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "path": "$['id']"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['createdDateTime']"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['lastModifiedDateTime']"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['iCalUId']"
                                },
                                "sink": {
                                    "name": "iCalUId",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['subject']"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['importance']"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['sensitivity']"
                                },
                                "sink": {
                                    "name": "Sensitivity",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['isAllDay']"
                                },
                                "sink": {
                                    "name": "IsAllDay",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['isCancelled']"
                                },
                                "sink": {
                                    "name": "IsCancelled",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['isOrganizer']"
                                },
                                "sink": {
                                    "name": "IsOrganizer",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['responseRequested']"
                                },
                                "sink": {
                                    "name": "ResponseRequested",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['body']['contentType']"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['body']['content']"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['start']['dateTime']"
                                },
                                "sink": {
                                    "name": "StartDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['start']['timeZone']"
                                },
                                "sink": {
                                    "name": "StartTimeZone",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['end']['dateTime']"
                                },
                                "sink": {
                                    "name": "EndDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['end']['timeZone']"
                                },
                                "sink": {
                                    "name": "EndTimeZone",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['location']['displayName']"
                                },
                                "sink": {
                                    "name": "LocationDisplayName",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "['status']['response']"
                                },
                                "sink": {
                                    "name": "AttendeeStatusResponse",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "['emailAddress']['name']"
                                },
                                "sink": {
                                    "name": "AttendeeName",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "['emailAddress']['address']"
                                },
                                "sink": {
                                    "name": "AttendeeAddress",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['organizer']['emailAddress']['name']"
                                },
                                "sink": {
                                    "name": "OrganizerName",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['organizer']['emailAddress']['address']"
                                },
                                "sink": {
                                    "name": "Organizer",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ODataType']"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['puser']"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ptenant']"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['datarow']"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['userrow']"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['pagerow']"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64"
                                }
                            }
                        ],
                        "collectionReference": "$['attendees']"
                    }
                },
                "inputs": [
                    {
                        "referenceName": "EventsJson",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "M365EventsParquet",
                        "type": "DatasetReference"
                    }
                ]
            }
        ],
        "parameters": {
            "batchStartTime": {
                "type": "string",
                "defaultValue": "2020-01-01T00:00:00Z"
            },
            "batchEndTime": {
                "type": "string",
                "defaultValue": "2022-01-01T00:00:00Z"
            }
        },
        "variables": {
            "users_table_name": {
                "type": "String",
                "defaultValue": "users"
            },
            "emails_table_name": {
                "type": "String",
                "defaultValue": "flattened_emails"
            },
            "augmented_emails_table_name": {
                "type": "String",
                "defaultValue": "augmented_emails"
            },
            "storageAccountKey": {
                "type": "String"
            },
            "jdbcUsername": {
                "type": "String"
            },
            "jdbcPassword": {
                "type": "String"
            }
        },
        "annotations": [],
        "lastPublishTime": "2021-07-08T15:47:57Z"
    },
    "type": "Microsoft.Synapse/workspaces/pipelines"
}