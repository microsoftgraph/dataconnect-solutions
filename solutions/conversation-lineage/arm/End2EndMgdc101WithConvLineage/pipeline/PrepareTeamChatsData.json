{
    "name": "PrepareTeamChatsData",
    "properties": {
        "activities": [
            {
                "name": "Delete Old Team Chats JSON Data",
                "type": "Delete",
                "dependsOn": [],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "dataset": {
                        "referenceName": "M365TeamChatsBlob",
                        "type": "DatasetReference"
                    },
                    "logStorageSettings": {
                        "linkedServiceName": {
                            "referenceName": "blobstorage_linkedservice",
                            "type": "LinkedServiceReference"
                        },
                        "path": {
                            "value": "@concat('logs/', pipeline().RunId, '/cleanup-logs/', pipeline().Pipeline)",
                            "type": "Expression"
                        }
                    },
                    "enableLogging": true,
                    "storeSettings": {
                        "type": "AzureBlobStorageReadSettings",
                        "recursive": true,
                        "enablePartitionDiscovery": false
                    }
                }
            },
            {
                "name": "M365 Team Chats To AZBS",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Delete Old Team Chats JSON Data",
                        "dependencyConditions": [
                            "Completed"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "Office365Source",
                        "dateFilterColumn": "ReceivedDateTime",
                        "startTime": {
                            "value": "@pipeline().parameters.batchStartTime",
                            "type": "Expression"
                        },
                        "endTime": {
                            "value": "@pipeline().parameters.batchEndTime",
                            "type": "Expression"
                        },
                        "userScopeFilterUri": "",
                        "outputColumns": [
                            {
                                "name": "Id"
                            },
                            {
                                "name": "CreatedDateTime"
                            },
                            {
                                "name": "LastModifiedDateTime"
                            },
                            {
                                "name": "ChangeKey"
                            },
                            {
                                "name": "Categories"
                            },
                            {
                                "name": "ReceivedDateTime"
                            },
                            {
                                "name": "SentDateTime"
                            },
                            {
                                "name": "HasAttachments"
                            },
                            {
                                "name": "InternetMessageId"
                            },
                            {
                                "name": "Subject"
                            },
                            {
                                "name": "BodyPreview"
                            },
                            {
                                "name": "Importance"
                            },
                            {
                                "name": "ParentFolderId"
                            },
                            {
                                "name": "ConversationId"
                            },
                            {
                                "name": "ConversationIndex"
                            },
                            {
                                "name": "IsRead"
                            },
                            {
                                "name": "IsDraft"
                            },
                            {
                                "name": "Body"
                            },
                            {
                                "name": "Sender"
                            },
                            {
                                "name": "From"
                            },
                            {
                                "name": "ToRecipients"
                            },
                            {
                                "name": "ReplyTo"
                            },
                            {
                                "name": "Flag"
                            },
                            {
                                "name": "Attachments"
                            }
                        ]
                    },
                    "sink": {
                        "type": "BinarySink",
                        "storeSettings": {
                            "type": "AzureBlobStorageWriteSettings"
                        }
                    },
                    "enableStaging": false
                },
                "inputs": [
                    {
                        "referenceName": "M365_Team_Chats",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "M365TeamChatsBlob",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Delete Old Team Chats Parquet Data",
                "type": "Delete",
                "dependsOn": [
                    {
                        "activity": "M365 Team Chats To AZBS",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "dataset": {
                        "referenceName": "M365TeamChatsParquet",
                        "type": "DatasetReference"
                    },
                    "logStorageSettings": {
                        "linkedServiceName": {
                            "referenceName": "blobstorage_linkedservice",
                            "type": "LinkedServiceReference"
                        },
                        "path": {
                            "value": "@concat('logs/', pipeline().RunId, '/cleanup-logs/', pipeline().Pipeline)",
                            "type": "Expression"
                        }
                    },
                    "enableLogging": true,
                    "storeSettings": {
                        "type": "AzureBlobStorageReadSettings",
                        "recursive": true,
                        "enablePartitionDiscovery": false
                    }
                }
            },
            {
                "name": "Flatten Team Chats By Attendees",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Delete Old Team Chats Parquet Data",
                        "dependencyConditions": [
                            "Completed"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "JsonSource",
                        "storeSettings": {
                            "type": "AzureBlobStorageReadSettings",
                            "recursive": true,
                            "wildcardFolderPath": "m365_team_chats_json",
                            "wildcardFileName": "*",
                            "enablePartitionDiscovery": false
                        },
                        "formatSettings": {
                            "type": "JsonReadSettings"
                        }
                    },
                    "sink": {
                        "type": "ParquetSink",
                        "storeSettings": {
                            "type": "AzureBlobStorageWriteSettings"
                        },
                        "formatSettings": {
                            "type": "ParquetWriteSettings"
                        }
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "path": "$['Id']"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['CreatedDateTime']"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['LastModifiedDateTime']"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['InternetMessageId']"
                                },
                                "sink": {
                                    "name": "InternetMessageId",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Subject']"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['BodyPreview']"
                                },
                                "sink": {
                                    "name": "BodyPreview",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Importance']"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ConversationId']"
                                },
                                "sink": {
                                    "name": "ConversationId",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ConversationIndex']"
                                },
                                "sink": {
                                    "name": "ConversationIndex",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['IsRead']"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['IsDraft']"
                                },
                                "sink": {
                                    "name": "IsDraft",
                                    "type": "Boolean"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Body']['ContentType']"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Body']['Content']"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Sender']['EmailAddress']['Name']"
                                },
                                "sink": {
                                    "name": "Sender_Name",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Sender']['EmailAddress']['Address']"
                                },
                                "sink": {
                                    "name": "Sender",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['From']['EmailAddress']['Name']"
                                },
                                "sink": {
                                    "name": "From_Name",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['From']['EmailAddress']['Address']"
                                },
                                "sink": {
                                    "name": "From",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "['EmailAddress']['Name']"
                                },
                                "sink": {
                                    "name": "RecipientName",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "['EmailAddress']['Address']"
                                },
                                "sink": {
                                    "name": "Recipient",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['Flag']['FlagStatus']"
                                },
                                "sink": {
                                    "name": "FlagStatus",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ODataType']"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['puser']"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['ptenant']"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['datarow']"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['userrow']"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64"
                                }
                            },
                            {
                                "source": {
                                    "path": "$['pagerow']"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64"
                                }
                            }
                        ],
                        "collectionReference": "$['ToRecipients']"
                    }
                },
                "inputs": [
                    {
                        "referenceName": "TeamChatsJson",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "M365TeamChatsParquet",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Copy Team Chats To Table",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Flatten Team Chats By Attendees",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "ParquetSource",
                        "storeSettings": {
                            "type": "AzureBlobStorageReadSettings",
                            "recursive": true,
                            "wildcardFolderPath": "m365_team_chats_parquet",
                            "wildcardFileName": "*.parquet",
                            "enablePartitionDiscovery": false
                        }
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "preCopyScript": "TRUNCATE TABLE flattened_team_chats",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "BOOLEAN"
                                },
                                "sink": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "UTF8"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "INT64"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "M365TeamChatsParquet",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "FlattenedTeamChatsTable",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Augment Flattened Team Chats",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Copy Team Chats To Table",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "AzureSqlSource",
                        "sqlReaderQuery": {
                            "value": "@{concat('with Internal_email_domains (EmailDomain) \nAS\n(\n    SELECT DISTINCT SUBSTRING(u.mail, CHARINDEX(''@'', u.mail), LEN(u.mail)) FROM users u WHERE u.mail IS NOT NULL\n)\nSELECT DISTINCT \ntc.Id,\ntc.CreatedDateTime,\ntc.LastModifiedDateTime,\ntc.InternetMessageId,\ntc.Subject,\ntc.BodyPreview,\ntc.Importance,\ntc.ConversationId,\ntc.ConversationIndex,\ntc.IsRead,\ntc.IsDraft,\ntc.Sender,\ntc.Sender_Name,\ntc.[From],\ntc.From_Name,\ntc.ContentType,\n[dbo].[udf_StripHTML](tc.[Content]) As Content,\ntc.Recipient,\ntc.RecipientName,\ntc.FlagStatus,\ntc.ODataType,\ntc.puser,\ntc.ptenant,\ntc.datarow,\ntc.userrow,\ntc.pagerow,\nu.aboutMe as SenderAboutMe,  \nu.birthday as SenderBirthday,   \nu.hireDate as SenderHireDate,  \nu.mySite as SenderMySite,  \nu.preferredName as SenderPreferredName,  \nu.accountEnabled as SenderAccountEnabled,  \nu.city as SenderCity,  \nu.companyName as SenderCompanyName,   \nu.country as SenderCountry,  \nu.createdDateTime as SenderCreatedDateTime,  \nISNULL(u.department, ''N/A'') as SenderDepartment,  \nu.displayName as SenderDisplayName,  \nu.givenName as SenderGivenName,  \nu.id as SenderId,  \nu.jobTitle as SenderJobTitle,  \nu.mail as SenderMail,  \nu.officeLocation as SenderOfficeLocation,  \nu.onPremisesImmutableId as SenderOnPremisesImmutableId,  \nu.postalCode as SenderPostalCode,  \nu.preferredLanguage as SenderPreferredLanguage,  \nu.state as SenderState,  \nu.streetAddress as SenderStreetAddress,  \nu.surname as SenderSurname,  \nu.usageLocation as SenderUsageLocation,  \nu.userPrincipalName as SenderUserPrincipalName,  \nu.userType as SenderUserType,  \nu.puser as SenderPuser ,  \nu.ptenant as SenderPtenant,  \nu.pAdditionalInfo as SenderPAdditionalInfo,  \nu.datarow as SenderDatarow,  \nu.userrow as SenderUserrow,  \nu.pagerow as SenderPagerow,\nISNULL(u.reportsTo, ''-'') as SenderReportsTo,\nu.managerEmail as SenderManagerEmail,\nuser_recipient_with_manager.managerEmail as RecipientManagerEmail,\nISNULL(user_recipient_with_manager.reportsTo, ''-'') as RecipientReportsTo\n, CAST(CASE WHEN SUBSTRING(tc.[Recipient], CHARINDEX(''@'', tc.[Recipient]), LEN(tc.[Recipient]))   NOT IN (SELECT EmailDomain FROM Internal_email_domains) THEN 1 ELSE 0 END AS BIT) as IsExternalChat\n, CAST(CASE WHEN tc.Recipient = u.managerEmail THEN 1 ELSE 0 END AS BIT) as ChatWithManager \n, CAST(CASE WHEN user_recipient_with_manager.managerEmail = tc.[From] THEN 1 ELSE 0 END AS BIT) as ChatWithSubordinate \n, '  , '''' , pipeline().parameters.batchEndTime, '''' ,' as Version\nFROM flattened_team_chats tc  JOIN users u \non tc.[From] = u.mail AND u.mail is not null\nLEFT JOIN users user_recipient_with_manager ON tc.Recipient = user_recipient_with_manager.mail;')}",
                            "type": "Expression"
                        },
                        "queryTimeout": "02:00:00",
                        "partitionOption": "None"
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "SenderHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "SenderAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "SenderCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsExternalChat",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsExternalChat",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ChatWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ChatWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ChatWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ChatWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "RecipientManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "RecipientManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "RecipientReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "RecipientReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Version",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Version",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "DedicatedSqlPoolDB",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "AugmentedFlattenedTeamChats",
                        "type": "DatasetReference"
                    }
                ]
            },
            {
                "name": "Aggregate Augmented Team Chats",
                "type": "Copy",
                "dependsOn": [
                    {
                        "activity": "Augment Flattened Team Chats",
                        "dependencyConditions": [
                            "Succeeded"
                        ]
                    }
                ],
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false,
                    "secureInput": false
                },
                "userProperties": [],
                "typeProperties": {
                    "source": {
                        "type": "AzureSqlSource",
                        "sqlReaderQuery": {
                            "value": "@{concat('select\nftc.[Id],\nftc.[InternetMessageId],\nftc.[CreatedDateTime],\nftc.[LastModifiedDateTime],\nftc.[Subject],\nftc.[BodyPreview],\nftc.[Importance],\nftc.[ConversationId],\nftc.[ConversationIndex],\nftc.[IsRead],\nftc.[IsDraft],\nftc.[Sender],\nftc.[Sender_Name],\nftc.[From],\nftc.[From_Name],\nftc.[ContentType],\n[dbo].[udf_StripHTML](ftc.[Content]) As Content,\nftc.[Recipient],\nftc.[RecipientName],\nftc.[FlagStatus],\nftc.[ODataType],\nftc.[puser],\nftc.[ptenant],\nftc.[datarow],\nftc.[userrow],\nftc.[pagerow],\nftc.[SenderAboutMe],\nftc.[SenderBirthday],\nftc.[SenderHireDate],\nftc.[SenderMySite],\nftc.[SenderPreferredName],\nftc.[SenderAccountEnabled],\nftc.[SenderCity],\nftc.[SenderCompanyName],\nftc.[SenderCountry],\nftc.[SenderCreatedDateTime],\nISNULL(ftc.[SenderDepartment], ''N/A'') as SenderDepartment,\nftc.[SenderDisplayName],\nftc.[SenderGivenName],\nftc.[SenderId],\nftc.[SenderJobTitle],\nftc.[SenderMail],\nftc.[SenderOfficeLocation],\nftc.[SenderOnPremisesImmutableId],\nftc.[SenderPostalCode],\nftc.[SenderPreferredLanguage],\nftc.[SenderState],\nftc.[SenderStreetAddress],\nftc.[SenderSurname],\nftc.[SenderUsageLocation],\nftc.[SenderUserPrincipalName],\nftc.[SenderUserType],\nftc.[SenderPuser],\nftc.[SenderPtenant],\nftc.[SenderPAdditionalInfo],\nftc.[SenderDatarow],\nftc.[SenderUserrow],\nftc.[SenderPagerow],\nISNULL(ftc.[SenderReportsTo], ''-'') as SenderReportsTo,\nftc.[SenderManagerEmail],\nagg_chats.ToNames,\nagg_chats.ToAddresses,\nCAST(CASE agg_chats.IsExternalChat WHEN 1 THEN 1 ELSE 0 END AS BIT) As IsExternalChat,\nCAST(CASE agg_chats.ChatWithManager WHEN 1 THEN 1 ELSE 0 END AS BIT) As ChatWithManager,\nCAST(CASE agg_chats.ChatWithSubordinate WHEN 1 THEN 1 ELSE 0 END AS BIT) As ChatWithSubordinate\n  from (select\n    InternetMessageId,\n      string_agg(cast([RecipientName] as [varchar](max)),'', '') As ToNames,\nstring_agg(cast([Recipient] as [varchar](max)),'', '') As ToAddresses,\nMAX(CONVERT(tinyint,IsExternalChat)) IsExternalChat,\nMAX(CONVERT(tinyint,ChatWithManager)) ChatWithManager,\nMAX(CONVERT(tinyint,ChatWithSubordinate)) ChatWithSubordinate\n  FROM augmented_flattened_team_chats\n  where Version = ', '''',  pipeline().parameters.batchEndTime, '''' , '\n  group by [InternetMessageId]) as agg_chats\n  CROSS APPLY\n  (SELECT TOP (1)\n[Id],\n[CreatedDateTime],\n[LastModifiedDateTime],\n[InternetMessageId],\n[Subject],\n[BodyPreview],\n[Importance],\n[ConversationId],\n[ConversationIndex],\n[IsRead],\n[IsDraft],\n[Sender],\n[Sender_Name],\n[From],\n[From_Name],\n[ContentType],\n[Content],\n[Recipient],\n[RecipientName],\n[FlagStatus],\n[ODataType],\n[puser],\n[ptenant],\n[datarow],\n[userrow],\n[pagerow],\n[SenderAboutMe],\n[SenderBirthday],\n[SenderHireDate],\n[SenderMySite],\n[SenderPreferredName],\n[SenderAccountEnabled],\n[SenderCity],\n[SenderCompanyName],\n[SenderCountry],\n[SenderCreatedDateTime],\n[SenderDepartment],\n[SenderDisplayName],\n[SenderGivenName],\n[SenderId],\n[SenderJobTitle],\n[SenderMail],\n[SenderOfficeLocation],\n[SenderOnPremisesImmutableId],\n[SenderPostalCode],\n[SenderPreferredLanguage],\n[SenderState],\n[SenderStreetAddress],\n[SenderSurname],\n[SenderUsageLocation],\n[SenderUserPrincipalName],\n[SenderUserType],\n[SenderPuser],\n[SenderPtenant],\n[SenderPAdditionalInfo],\n[SenderDatarow],\n[SenderUserrow],\n[SenderPagerow],\n[IsExternalChat],\n[ChatWithManager],\n[ChatWithSubordinate],\n[SenderReportsTo],\n[SenderManagerEmail]\nFROM [dbo].[augmented_flattened_team_chats] where InternetMessageId = agg_chats.InternetMessageId) ftc', '')}",
                            "type": "Expression"
                        },
                        "queryTimeout": "02:00:00",
                        "partitionOption": "None"
                    },
                    "sink": {
                        "type": "AzureSqlSink",
                        "disableMetricsCollection": false
                    },
                    "enableStaging": false,
                    "translator": {
                        "type": "TabularTranslator",
                        "mappings": [
                            {
                                "source": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Id",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "InternetMessageId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "CreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "LastModifiedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Subject",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "BodyPreview",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Importance",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ConversationId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ConversationIndex",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsRead",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsDraft",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sender",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Sender_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "From",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "From_Name",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ContentType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Content",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "Recipient",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "RecipientName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "FlagStatus",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ODataType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "puser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ptenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "datarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "userrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "pagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderAboutMe",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderBirthday",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "SenderHireDate",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderMySite",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPreferredName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "SenderAccountEnabled",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCity",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCompanyName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderCountry",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                },
                                "sink": {
                                    "name": "SenderCreatedDateTime",
                                    "type": "DateTime",
                                    "physicalType": "datetime2"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderDepartment",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderDisplayName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderGivenName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderJobTitle",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderMail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderOfficeLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderOnPremisesImmutableId",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPostalCode",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPreferredLanguage",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderState",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderStreetAddress",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderSurname",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUsageLocation",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUserPrincipalName",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderUserType",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPuser",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPtenant",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderPAdditionalInfo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderDatarow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderUserrow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                },
                                "sink": {
                                    "name": "SenderPagerow",
                                    "type": "Int64",
                                    "physicalType": "bigint"
                                }
                            },
                            {
                                "source": {
                                    "name": "IsExternalChat",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "IsExternalChat",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ChatWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ChatWithManager",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "ChatWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                },
                                "sink": {
                                    "name": "ChatWithSubordinate",
                                    "type": "Boolean",
                                    "physicalType": "bit"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderReportsTo",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "SenderManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "SenderManagerEmail",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ToNames",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ToNames",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            },
                            {
                                "source": {
                                    "name": "ToAddresses",
                                    "type": "String",
                                    "physicalType": "varchar"
                                },
                                "sink": {
                                    "name": "ToAddresses",
                                    "type": "String",
                                    "physicalType": "varchar"
                                }
                            }
                        ],
                        "typeConversion": true,
                        "typeConversionSettings": {
                            "allowDataTruncation": true,
                            "treatBooleanAsNumber": false
                        }
                    }
                },
                "inputs": [
                    {
                        "referenceName": "DedicatedSqlPoolDB",
                        "type": "DatasetReference"
                    }
                ],
                "outputs": [
                    {
                        "referenceName": "AugmentedTeamChatsTable",
                        "type": "DatasetReference"
                    }
                ]
            }
        ],
        "parameters": {
            "batchStartTime": {
                "type": "string",
                "defaultValue": "2020-01-01T00:00:00Z"
            },
            "batchEndTime": {
                "type": "string",
                "defaultValue": "2022-01-01T00:00:00Z"
            }
        },
        "variables": {
            "users_table_name": {
                "type": "String",
                "defaultValue": "users"
            },
            "emails_table_name": {
                "type": "String",
                "defaultValue": "flattened_emails"
            },
            "augmented_emails_table_name": {
                "type": "String",
                "defaultValue": "augmented_emails"
            },
            "storageAccountKey": {
                "type": "String"
            },
            "jdbcUsername": {
                "type": "String"
            },
            "jdbcPassword": {
                "type": "String"
            }
        },
        "annotations": [],
        "lastPublishTime": "2021-07-08T16:21:11Z"
    },
    "type": "Microsoft.Synapse/workspaces/pipelines"
}