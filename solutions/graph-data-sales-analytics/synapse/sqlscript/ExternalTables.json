{
	"name": "ExternalTables",
	"properties": {
		"content": {
			"query": "-- Create analytics_db Database\n\n-- Create master key in databases with some password (one-off per database)\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = '*********'\nGO\n\n-- Create databases scoped credential that use Managed Identity, SAS token or Service Principal. \n-- User needs to create only database-scoped credentials that should be used to access data source:\nCREATE DATABASE SCOPED CREDENTIAL WorkspaceIdentity\nWITH IDENTITY = 'Managed Identity'\nGO\nCREATE DATABASE SCOPED CREDENTIAL SasCredential\nWITH IDENTITY = 'SHARED ACCESS SIGNATURE', SECRET = '***********'\nGO\nCREATE DATABASE SCOPED CREDENTIAL SPNCredential WITH\nIDENTITY = '*************@https://login.microsoftonline.com/*********/oauth2/token' \n, SECRET = '***************'\nGO\n\n-- Create data source that one of the credentials above, external file format, and external tables that reference this data source and file format:\nCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] WITH ( FORMAT_TYPE = PARQUET)\nGO\n\n-- Delta Lake external table\nCREATE EXTERNAL FILE FORMAT DeltaLakeFormat WITH (  FORMAT_TYPE = DELTA );\nGO\n\nCREATE EXTERNAL DATA SOURCE mysample\nWITH (    LOCATION   = 'https://<storage_account>.dfs.core.windows.net/<container>/<path>'\n-- Uncomment one of these options depending on authentication method that you want to use to access data source:\n--,CREDENTIAL = WorkspaceIdentity \n--,CREDENTIAL = SasCredential \n--,CREDENTIAL = SPNCredential\n)\n\n-- opportunity table\nCREATE EXTERNAL TABLE [dbo].[Opportunity] (\n\t[Id] [varchar](100) NULL,\n\t[IsDeleted] [bit] NULL,\n\t[AccountId] [varchar](100) NULL,\n\t[Name] [varchar](115) NULL,\n\t[StageName] [varchar](100) NULL,\n\t[Amount] [float] NULL,\n\t[CloseDate] [varchar](50) NULL,\n\t[Type] [varchar](50) NULL,\n\t[IsClosed] [bit] NULL,\n\t[IsWon] [bit] NULL,\n\t[OwnerId] [varchar](50) NULL,\n\t[CreatedDate] [varchar](50) NULL,\n\t[LastModifiedDate] [varchar](50) NULL,\n\t[ContactId] [varchar](50) NULL\n) \nWITH \n(\n    LOCATION = 'Opportunity', \n    DATA_SOURCE = [sfsc_gold],\n    FILE_FORMAT = [DeltaLakeFormat] \n);\n\n-- User Table\nCREATE EXTERNAL TABLE [dbo].[User]\n(\n\t[Id] [varchar](100) NULL,\n\t[AccountId] [varchar](255) NULL,\n\t[ContactId] [varchar](100) NULL,\n\t[CreatedById] [varchar](100) NULL,\n\t[CreatedDate] [varchar](100) NULL,\n\t[Department] [varchar](100) NULL,\n\t[Name] [varchar](255) NULL,\n\t[EmployeeNumber] [varchar](255) NULL,\n\t[IsActive] [bit] NULL,\n\t[LastModifiedById] [varchar](255) NULL,\n\t[LastModifiedDate] [varchar](255) NULL\n)\nWITH\n(\n\tLOCATION = 'User', \n\tDATA_SOURCE = [sfsc_gold],\n\tFILE_FORMAT = [DeltaLakeFormat]\n);\n\n\n-- Account Table\nCREATE EXTERNAL TABLE [dbo].[Account]\n(\n\t[Id] [varchar](100) NULL,\n\t[IsDeleted] [bit] NULL,\n\t[Name] [varchar](100) NULL,\n\t[AccountNumber] [varchar](100) NULL,\n\t[Industry] [varchar](100) NULL,\n\t[AnnualRevenue] [float] NULL,\n\t[Rating] [varchar](100) NULL,\n\t[OwnerId] [varchar](100) NULL,\n\t[LastModifiedDate] [varchar](100) NULL\n)\nWITH\n(\n\tLOCATION = 'Account', \n\tDATA_SOURCE = [sfsc_gold],\n\tFILE_FORMAT = [DeltaLakeFormat]\n);\n\n\n-- Contact Table\nCREATE EXTERNAL TABLE [dbo].[Contact]\n(\n\t[Id] [varchar](50) NULL,\n\t[IsDeleted] [bit] NULL,\n\t[AccountId] [varchar](50) NULL,\n\t[Name] [varchar](100) NULL,\n\t[OwnerId] [varchar](100) NULL,\n\t[CreatedDate] [varchar](100) NULL,\n\t[LastModifiedDate] [varchar](100) NULL\n)\nWITH\n(\n\tLOCATION = 'Contact', \n\tDATA_SOURCE = [sfsc_gold],\n\tFILE_FORMAT = [DeltaLakeFormat]\n);\n\n-- Email Table\nCREATE EXTERNAL TABLE [dbo].[Email] (\n    email_id VARCHAR(255) ,\n    sent_date_time VARCHAR(255),\n    last_modified_date_time VARCHAR(255),\n    body_preview VARCHAR(MAX),\n    conversation_id VARCHAR(MAX),\n    conversation_index VARCHAR(MAX),\n    from_email_address VARCHAR(MAX),\n    to_recipient_list VARCHAR(MAX),\n    email_subject VARCHAR(MAX),\n    email_text VARCHAR(MAX),\n    opportunity_id VARCHAR(MAX),\n    Scaled_Sentiment VARCHAR(MAX),\n    Label VARCHAR(MAX)\n)\nWITH\n(\n\tLOCATION = 'EmailSentiment', \n\tDATA_SOURCE = [M365],\n\tFILE_FORMAT = [DeltaLakeFormat]\n);\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "golddatabase",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}